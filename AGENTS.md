# Agentic Coding Guidelines (AGENTS.md)

This document provides instructions for AI agents (and human developers) working on the `migestion` repository. It outlines build processes, code styles, and operational mandates.

## 1. Environment & Architecture

- **Root**: `C:\Users\eduar\OneDrive\Escritorio\Profesional\migestion`
- **Monorepo**: Uses npm workspaces.
  - `packages/api`: Backend (Node.js, Express, Prisma, TypeScript).
  - `packages/web`: Frontend (React, Vite, TypeScript, Tailwind CSS).
- **Database**: PostgreSQL (Prisma ORM).
- **Cache**: Redis.

## 2. Build, Lint, & Test Commands

### **Global Commands (Root)**

- **Install**: `npm install`
- **Build All**: `npm run build`
- **Lint All**: `npm run lint`
- **Test All**: `npm run test`
- **Dev**: `npm run dev` (starts both api and web if possible, or use specific workspace commands)

### **Workspace Specifics**

| Task           | Backend (`packages/api`)                  | Frontend (`packages/web`)                     |
| :------------- | :---------------------------------------- | :-------------------------------------------- |
| **Dev Server** | `npm run dev:api`                         | `npm run dev:web`                             |
| **Build**      | `npm run build:api`                       | `npm run build:web`                           |
| **Lint**       | `npm run lint --workspace=@migestion/api` | `npm run lint --workspace=@migestion/web`     |
| **Test**       | `npm run test:api`                        | `npm run test:web`                            |
| **E2E Test**   | N/A                                       | `npm run test:e2e --workspace=@migestion/web` |

### **Running Single Tests**

- **Jest (API/Web)**:
  To run a specific test file, pass the relative path (matched by regex) to the test command.
  _Example (API):_ `npm run test:api -- src/modules/auth/auth.service.test.ts`
  _Example (Web):_ `npm run test:web -- src/components/Button.test.tsx`
- **Playwright (E2E)**:
  `npm run test:e2e --workspace=@migestion/web -- -g "specific test name"`

## 3. Code Style & Conventions

### **General**

- **TypeScript**: Strict mode is enabled. No `any`. Use explicit types or interfaces.
- **Formatting**: Prettier is authoritative. Run `npm run format`.
- **Linting**: ESLint is authoritative. Fix errors before committing.

### **Imports**

- **Backend (`@migestion/api`)**:
  - Use ES modules syntax (`import ... from ...`).
  - **Important**: Local imports must include the `.js` extension (e.g., `import { app } from './app.js';`).
  - Group imports: Node built-ins -> External libs -> Internal aliases/paths -> Local files.
- **Frontend (`@migestion/web`)**:
  - Standard ES imports.
  - No `.js` extension required for local files.
  - Prefer absolute imports if configured (check `tsconfig.json`), otherwise consistent relative imports.

### **Naming**

- **Files**: `kebab-case` (e.g., `user-controller.ts`, `auth-service.ts`).
- **Classes**: `PascalCase` (e.g., `UserController`).
- **Interfaces/Types**: `PascalCase` (e.g., `User`, `AuthPayload`).
- **Variables/Functions**: `camelCase`.
- **Constants**: `UPPER_SNAKE_CASE` for true constants.
- **React Components**: `PascalCase` (e.g., `UserProfile.tsx`).

### **Structure & Patterns**

- **Backend**:
  - Modular architecture (`src/modules/`).
  - Pattern: `Controller` -> `Service` -> `Repository/Prisma`.
  - Use `zod` for validation.
  - Infrastructure concerns (Redis, Socket.IO) go in `src/infrastructure/`.
- **Frontend**:
  - Components in `src/components/` (atomic/reusable) or `src/pages/` (views).
  - State management via `zustand` (`src/stores/`).
  - Data fetching via `react-query` (`src/hooks/` or `src/services/`).
  - Styling with Tailwind CSS classes.

### **Error Handling**

- **Backend**:
  - Use custom error classes (if available) or standard HTTP errors.
  - Centralized error handling middleware.
  - Log errors via `winston` (`src/shared/utils/logger.js`), do NOT use `console.log`.
- **Frontend**:
  - Use error boundaries for UI crashes.
  - Handle API errors gracefully in `react-query` hooks or `try/catch` blocks.
  - Display user-friendly error messages (e.g., via toast notifications).

## 4. Workflows & Rules

1. **Search First**: Before changing code, search for existing patterns using `grep` or `glob`.
2. **Verify**: Always run the relevant `build` and `lint` command after changes.
3. **Tests**: Add unit tests for new logic. Run existing tests to ensure no regressions.
4. **No Placeholders**: Write complete, functional code.
5. **Secrets**: Never commit secrets/env files. Use environment variables.

## 5. Deployment

- **Docker**: Production builds use `Dockerfile.api` (multi-stage build).
- **Compose**: `docker-compose.yml` for local dev (DB, Redis). `docker-compose.prod.yml` for production.

---

_Generated by opencode for `migestion` repository._
